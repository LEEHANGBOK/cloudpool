        <h4 class="card-title">Dropzone</h4>
        <h6 class="card-subtitle">For multiple file upload put class <code>.dropzone</code> to form.</h6>
        <!-- <form id="uploadform" action='dropbox/upload/<%=FolderID%>' method='post' enctype="multipart/form-data" class="dropzone">
            <div class="fallback">
                <input name="userfile" type="file" multiple />
            </div> -->
            <form id="upload_form" name="uploadform" enctype="multipart/form-data">

            <button class="btn btn-lg upload-btn" type="button">Upload File</button>
          <input id="upload-input" type="file" name="uploads[]" >
        </form>
        <!-- <form name="uploadform" id="uploadform" action='dropbox/upload/<%=FolderID%>' method='post' enctype="multipart/form-data">
          <input type='file' name='userfile'>
          <button type="button" onclick='UploadSubmit()' >업로드</button>

        </form> -->

    <form id="file_form" name='action_dropbox' method='post'>
        <button type="button" onClick='Submit(1)' >다운로드</button>
        <button type="button" onClick='Delete()' >삭제</button>
        <input type="text" name="filename" placeholder="newname">
        <button type="button" onClick='Rename()' >변경</button>
        <p></p>
        <select name="selecttype">
          <option value="document">문서</option>
          <option value="PDF">PDF</option>
          <option value="video">video</option>
          <option value="image">이미지</option>
          <option value="audio">오디오</option>
          <option value="etc">기타</option>
        </select>
        <button  type="button" onClick='Select()' >골라보기</button>
        <p></p>
        <select name="searchfoldertype">
          <option value="root">전체 폴더</option>
          <option value="<%=FolderID%>">현재 폴더</option>
        </select>

        <input type="text" name="searchname" placeholder="검색">
        <button type="button" onClick='Search();'>검색하기</button>
        <p></p>
        <button type="button" onClick='Refresh()' >파일 리스트 최신화</button>
        <p></p>
        <button type="button" onClick='CreateFolder()' >폴더 만들기</button>

        <table border="1" id="table_dropbox" data-id='<%=FolderID%>'>
                <tr>
                    <td> </td>
                    <td>번   호</td>
                    <td>파일이름</td>
                    <td>파일형식</td>
                    <td>올린날짜</td>
                    <td>파일용량</td>
                </tr>
                <!-- 이전 폴더로 이동 -->
                <%
                var folderList = FolderID.split("*");
                if(folderList[0]==FolderID){%>
                  <tr data-id=''>
                     <td></td>
                      <td></td>
                      <!--폴더라면 폴더 ID를 넘겨서 다시 URL을 전송한다.-->
                      <td><a href="#" onclick ="moveFolder_dropbox(this)" value="folder/">/</a></td>
                      <td></td>
                      <td></td>
                      <td></td>
                  </tr>


                  <%
                }
                else{
                  var beforeFolder='';
                  var beforeFolderName='';
                  for(var i=0; i<folderList.length-1 ; i++){
                    if(i==0){
                      beforeFolder=folderList[i];
                      beforeFolderName=folderList[i];
                    }
                    else{
                      beforeFolder=beforeFolder+"*"+folderList[i];
                      beforeFolderName=beforeFolderName+"/"+folderList[i];
                    }
                  }

                %>
                <tr ondrop="dropFormove(event)" ondragover="allowDrop(event)" value="<%=beforeFolder%>">
                   <td></td>
                    <td></td>
                    <!--폴더라면 폴더 ID를 넘겨서 다시 URL을 전송한다.-->
                    <td >
                      <a data-id='<%=beforeFolder%>' href="#" onclick ="moveFolder_dropbox(this)" value='folder/<%=beforeFolder%>' ><%=beforeFolderName%></a></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                  <%
                }
                <!-- 한글 -> 유니코드 -->


                  <!--byte to kb,mb,gb  -->
                  function formatBytes(bytes,decimals) {
                     if(bytes == 0) return '0 Bytes';
                     var k = 1024,
                         dm = decimals || 2,
                         sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],
                         i = Math.floor(Math.log(bytes) / Math.log(k));
                     return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
                  }
                    if(filelist.length>0){
                       for(var i=0; i<filelist.length; i++)
                       {
                          var oneItem = filelist[i];
                          var size = formatBytes(oneItem.size,3);
                          if(oneItem.mimeType=='folder'){
                            if(FolderID==''){
                              //if(oneItem.name=="%"){
                              //  var Foldername = oneItem.name+'25';
                            //  }
                            //  else
                              var Foldername = oneItem.name;
                            %>
                            <tr ondrop="dropFormove(event)" ondragover="allowDrop(event)" value="<%=Foldername%>">
                               <td><input type="checkbox" name="name" value="<%=oneItem.name%>" ></td>
                                <td><%=i%></td>
                                <!--폴더라면 폴더 ID를 넘겨서 다시 URL을 전송한다.-->
                                <td data-id='<%=Foldername%>'>
                                  <!-- <a href="/dropbox/<%=Foldername%>" id="Folder_<%=i%>" value="<%=Foldername%>"> -->

                                  <a href="#" onclick ="moveFolder_dropbox(this)" value='folder/<%=Foldername%>' ><%=oneItem.name%></a></td>
                                <td><%=oneItem.mimeType%></td>
                                <td><%=oneItem.modifiedTime%></td>
                                <td><%=size%></td>
                            </tr>
                            <%
                            }
                            else {
                              //if(oneItem.name=="%"){
                              //  var Foldername = oneItem.name+'25';
                              //}
                              //else
                              var Foldername = oneItem.name;
                            %>
                            <tr ondrop="dropFormove(event)" ondragover="allowDrop(event)" value="<%=FolderID%>*<%=Foldername%>">
                               <td><input type="checkbox" name="name" value="<%=oneItem.name%>" ></td>
                                <td><%=i%></td>
                                <!--폴더라면 폴더 ID를 넘겨서 다시 URL을 전송한다.-->
                                <td data-id='<%=FolderID%>*<%=Foldername%>'>
                                  <!-- <a href="/dropbox/<%=FolderID%>*<%=Foldername%>"  id="Folder_<%=i%>" value="<%=FolderID%>*<%=Foldername%>"> -->
                                  <a href="#" onclick ="moveFolder_dropbox(this)" value='folder/<%=FolderID%>*<%=Foldername%>'><%=oneItem.name%></a></td>
                                <td><%=oneItem.mimeType%></td>
                                <td><%=oneItem.modifiedTime%></td>
                                <td><%=size%></td>
                            </tr>
                            <%
                            }
                          }
                          else{

                            <!--파일인 경우 name에 path까지 붙여서 한다.  -->
                            for(var j=0 ; j < oneItem.path_list.length -1 ; j++){
                              if(j==0){
                                var filename='';
                              }
                              else{
                                filename = filename + "*" + oneItem.path_list[j];
                              }
                            }
                            filename = filename + "*" + oneItem.name;

                            %>
                          <tr ondragstart="dragStart(event)" draggable="true" value="<%=filename%>">
                             <td><input type="checkbox" name="name" value="<%=filename%>" ></td>
                              <td><%=i%></td>
                              <td><%=oneItem.name%></td>
                              <td><%=oneItem.mimeType%></td>
                              <td><%=oneItem.modifiedTime%></td>
                              <td><%=size%></td>
                          </tr>
                            <%
                        }
                      }
                    }
                  %>
        </table>
  </form>
  <div class="wrap-loading display-none">
    <div><img src="./images/loading1.gif" /></div>
  </div>

  <script language=javascript>
    function dragStart(event) {
      event.dataTransfer.setData("data", event.target.attributes[2].nodeValue);
    }
    function allowDrop(event) {
        event.preventDefault();
    }
    function dropFormove(event) {
        event.preventDefault();
        var filename = event.dataTransfer.getData("data");
        var toFolder =event.target.dataset.id;
        console.log(event);
        var body= {
          "filename" : filename,
          "toFolder" : toFolder
        }
        alert("filename : "+filename +" \ntoFolder :" + toFolder);

        $.ajax({
             type: "POST",
             url: "dropbox/move/",
             async: true,
             data: body,
             dataType: "JSON",
             success: function(json) {
               console.log(json);
               $('.graph').load("dropbox/folder/<%=FolderID%>");
              },beforeSend:function(){
                  // (이미지 보여주기 처리)
                $('.wrap-loading').removeClass('display-none');
              },complete:function(){
                  // (이미지 감추기 처리)
              $('.wrap-loading').addClass('display-none');
              },
             error: function(error) {
                console.log(error);
             }
          });
    }

    function Submit(index){
      if(index===1){

        // action_dropbox.action='dropbox/download/<%=FolderID%>';
        action_dropbox.action='dropbox/download/';
      }
      if(index===2){

        action_dropbox.action='dropbox/delete/';
        $('.graph').load("dropbox/folder/<%=FolderID%>");
      }
      action_dropbox.submit();
    };

    function Delete(){
      // 체크박스의 갯수를 변수에 담는다.
      var chklen = action_dropbox.name.length;
      var name ='';
      // 체크박스 갯수만큼 for 문을 돌려 체크된 놈의 value값을 가져온다.
       for(i=0; i<chklen; i++){
          if(action_dropbox.name[i].checked == true){
              name =action_dropbox.name[i].value;
              break;
          }
        }
      if(name==''){
        alert("이름을 변경하실 파일이나 폴더를 체크해주세요");
      }
      else{
        var body= {
          "name" : name
        }

        $.ajax({
             type: "POST",
             url: "dropbox/delete/",
             async: false,
             data: body,
             dataType: "JSON",
             success: function(json) {
               console.log(json);
               $('.graph').load("dropbox/folder/<%=FolderID%>");
             },
             beforeSend:function(){
                 // (이미지 보여주기 처리)
               $('.wrap-loading').removeClass('display-none');
             },complete:function(){
                 // (이미지 감추기 처리)
             $('.wrap-loading').addClass('display-none');
             },
             error: function(error) {
                console.log(error);
             }
          });
      }
    }

    function Refresh(){
      $.ajax({
           type: "GET",
           url: "dropbox/refresh/",
           async: false,
           success: function(json) {
             console.log(json);
             $('.graph').load("dropbox/folder/<%=FolderID%>");
           },beforeSend:function(){
               // (이미지 보여주기 처리)
             $('.wrap-loading').removeClass('display-none');
           },complete:function(){
               // (이미지 감추기 처리)
           $('.wrap-loading').addClass('display-none');
           },
           error: function(error) {
              console.log(error);
           }
        });
    }

    function UploadSubmit(){
        uploadform.action='dropbox/upload/<%=FolderID%>';
        uploadform.submit();
        $('.graph').load("dropbox/<%=FolderID%>");
    };

    $('.upload-btn').on('click', function (){
        $('#upload-input').click();
        $('.progress-bar').text('0%');
        $('.progress-bar').width('0%');
    });
    $('#upload-input').on('change', function(){
      var files = $(this).get(0).files;
      if (files.length > 0){
        // create a FormData object which will be sent as the data payload in the
        // AJAX request
        var formData = new FormData();
        // loop through all the selected files and add them to the formData object
        for (var i = 0; i < files.length; i++) {
          var file = files[i];

          // add the files to formData object for the data payload
          formData.append('uploads_list', file, file.name);
        };
        $.ajax({
          url: 'dropbox/upload/<%=FolderID%>',
          type: 'POST',
          data: formData,
          async: false,
          processData: false,
          contentType: false,
          success: function(response){
            console.log("success");
            $('.graph').load("dropbox/folder/<%=FolderID%>");
           },
          complete: function(response){
            console.log("complete");
            $('.graph').load("dropbox/folder/<%=FolderID%>");
          }
          // ,
          // xhr: function() {
          //   // create an XMLHttpRequest
          //   var xhr = new XMLHttpRequest();
          //   xhr.onreadystatechange = function(){
          //     if(this.readyState == 4 && this.status == 200){
          //       alert(xhr.responseText);
          //     }
          //   };
          //   // listen to the 'progress' event
          //   xhr.upload.addEventListener('progress', function(evt) {
          //     launch_toast();
          //     if (evt.lengthComputable) {
          //       // calculate the percentage of upload completed
          //       var percentComplete = evt.loaded / evt.total;
          //       percentComplete = parseInt(percentComplete * 100);
          //
          //       // update the Bootstrap progress bar with the new percentage
          //       $('.progress-bar').text(percentComplete + '%');
          //       $('.progress-bar').width(percentComplete + '%');
          //
          //       // once the upload reaches 100%, set the progress bar text to done
          //       if (percentComplete === 100) {
          //         $('.progress-bar').html('Done');
          //         $('.graph').load("dropbox/<%=FolderID%>");
          //       }
          //
          //     }
          //
          //   }, false);
          //
          //
          //   $('.graph').load("dropbox/folder/<%=FolderID%>");
          //   return xhr;
          // }
        });

      }
    });

    function launch_toast() {
    var x = document.getElementById("toast")
    x.className = "show";
    setTimeout(function(){ x.className = x.className.replace("show", ""); }, 15000);
    }

    function Rename(){
      // 체크박스의 갯수를 변수에 담는다.
      var chklen = action_dropbox.name.length;
      var originname ='';
      // 체크박스 갯수만큼 for 문을 돌려 체크된 놈의 value값을 가져온다.
       for(i=0; i<chklen; i++){
          if(action_dropbox.name[i].checked == true){
              originname =action_dropbox.name[i].value;
              break;
          }
        }
      if(originname==''){
        alert("이름을 변경하실 파일이나 폴더를 체크해주세요");
      }
      else{
        var newname = action_dropbox.filename.value;

        var body= {
          "originname" : originname,
          "newname" : newname
        }

        $.ajax({
             type: "POST",
             url: "dropbox/rename/<%=FolderID%>",
             async: true,
             data: body,
             dataType: "JSON",
             success: function(json) {
               console.log(json);
               $('.graph').load("dropbox/folder/<%=FolderID%>");
             },
             beforeSend:function(){
                 // (이미지 보여주기 처리)
               $('.wrap-loading').removeClass('display-none');
             },complete:function(){
                 // (이미지 감추기 처리)
             $('.wrap-loading').addClass('display-none');
             },
             error: function(error) {
                console.log(error);
             }
          });
      }
    }

    function Select(){
      var selecttype = action_dropbox.selecttype.value;

      var body= {
        "selecttype" : selecttype
      }
      $.ajax({
           type: "POST",
           url: "dropbox/select/<%=FolderID%>",
           async: false,
           data: body,
           dataType: "JSON",
           success: function(json) {
             var obj = JSON.stringify(json);
             console.log(obj);

             $('.graph').load("dropbox/selectview/folder/<%=FolderID%>",{obj:obj});
           },
           beforeSend:function(){
               // (이미지 보여주기 처리)
             $('.wrap-loading').removeClass('display-none');
           },complete:function(){
               // (이미지 감추기 처리)
           $('.wrap-loading').addClass('display-none');
           },
           error: function(error) {
              console.log(error);
           }
        });
    }

    function Search(){
      var searchname = action_dropbox.searchname.value;
      var searchFolder = action_dropbox.searchfoldertype.value;

      var body= {
        "searchname" : searchname,
        "searchfolder" : searchFolder
      }
      $.ajax({
           type: "POST",
           url: "dropbox/search/<%=FolderID%>",
           async: false,
           data: body,
           dataType: "JSON",
           success: function(json) {
             var obj = JSON.stringify(json);
             $('.graph').load("dropbox/searchview/folder/<%=FolderID%>",{obj:obj});
           },
           beforeSend:function(){
               // (이미지 보여주기 처리)
             $('.wrap-loading').removeClass('display-none');
           },complete:function(){
               // (이미지 감추기 처리)
           $('.wrap-loading').addClass('display-none');
           },
           error: function(error) {
              console.log(error);
           }
        });
    }



  </script>
  <style type="text/css" >

    .wrap-loading{ /*화면 전체를 어둡게 합니다.*/
    position: fixed;
    left:0;
    right:0;
    top:0;
    bottom:0;
    background: rgba(0,0,0,0.2); /*not in ie */
    filter: progid:DXImageTransform.Microsoft.Gradient(startColorstr='#20000000', endColorstr='#20000000');    /* ie */
    }
    .wrap-loading div{ /*로딩 이미지*/
        position: fixed;
        top:20%;
        left:20%;
        margin-left: -21px;
        margin-top: -21px;
    }
    .display-none{ /*감추기*/
        display:none;
    }
</style>

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>
  <script src="js/loadfolder.js"></script>
  <!-- <script src="js/upload.js"></script> -->
  <script src="js/lib/dropzone/dropzone.js"></script>
